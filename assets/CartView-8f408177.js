import{_ as S,o as c,c as h,d as t,F as p,f as _,g as m,t as g,a as f,h as $,v as b}from"./index-ea1b4d6f.js";const{VITE_APP_URL:n,VITE_APP_PATH:d}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_APP_PATH:"ryanpro",BASE_URL:"/Vue_week6_vite/",MODE:"production",DEV:!1,PROD:!0},v={data(){return{products:[],product:{},carts:[],cartStatus:!1,isLoading:!1,fullPage:!0,loadingStatus:{loading:!1,loadingItem:""},order:{user:{email:"",name:"",tel:"",address:""},message:""}}},methods:{getProducts(){const s=`${n}api/${d}/products/all`;this.$http.get(s).then(a=>{this.products=a.data.products}).catch(a=>{alert(a.response.data.message)})},getProduct(s){const a=`${n}api/${d}/product/${s}`;this.loadingStatus.loadingItem=s,this.loadingStatus.loading=!0,this.$http.get(a).then(l=>{this.loadingStatus.loadingItem="",this.loadingStatus.loading=!1,this.product=l.data.product,this.$refs.modal.show()}).catch(l=>{this.loadingStatus.loading=!1,alert(l.response.data.message)})},addToCart(s,a=1){this.loadingStatus.loadingItem=s,this.loadingStatus.loading=!0;const l={product_id:s,qty:a},r=`${n}api/${d}/cart`;this.$http.post(r,{data:l}).then(o=>{console.log("🚀 ~ file: index.js:54 ~ .then ~ res",o),this.loadingStatus.loadingItem="",this.loadingStatus.loading=!1,this.getCart(),this.$refs.modal.hide()}).catch(o=>{this.loadingStatus.loading=!1,alert(o.response.data.message)})},getCart(){const s=`${n}api/${d}/cart`;this.loadingStatus.loading=!0,this.$http.get(s).then(a=>{this.loadingStatus.loadingItem="",this.loadingStatus.loading=!1,this.carts=a.data.data,this.carts.carts.length===0?this.cartStatus=!1:this.cartStatus=!0}).catch(a=>{this.loadingStatus.loading=!1,alert(a.response.data.message)})},changeQty(s,a,l){this.loadingStatus.loadingItem=a;const r=`${n}api/${d}/cart/${a}`,o={product_id:s,qty:l};this.$http.put(r,{data:o}).then(()=>{this.getCart(),alert("該項商品數量已變更!"),this.loadingStatus.loadingItem=""}).catch(u=>{alert(u.response.data.message)})},removeCartProduct(s,a){this.loadingStatus.loadingItem=s;const l=`${n}api/${d}/cart/${s}`;this.$http.delete(l).then(()=>{this.loadingStatus.loadingItem="",alert(`${a}該項商品已經移除!`),this.getCart()}).catch(r=>{alert(r.response.data.message)})},removeCartAll(){const s=`${n}api/${d}/carts`;this.loadingStatus.loading=!0,this.$http.delete(s).then(()=>{this.loadingStatus.loadingItem="",this.loadingStatus.loading=!1,this.cartStatus=!1,this.getCart()}).catch(a=>{alert(a.response.data.message),this.loadingStatus.loading=!1})},onSubmit(){const s=`${n}/api/${d}/order`;this.loadingStatus.loading=!0;const a=this.order;this.$http.post(s,{data:a}).then(()=>{this.loadingStatus.loading=!1}).catch(l=>{alert(l.response.data.message),this.loadingStatus.loading=!1})},isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"}},components:{},mounted(){this.getProducts(),this.getCart()}},C={class:"text-end"},I=["disabled"],P={class:"table align-middle"},y=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價"),t("th",null,"小計")])],-1),x=["onClick","disabled"],V={key:0,class:"fas fa-spinner fa-pulse"},k={class:"input-group input-group-sm"},A={class:"input-group mb-3"},E=["onUpdate:modelValue","onChange","disabled"],T=["value"],w={class:"text-end"},D={class:"text-end"},L=t("td",{colspan:"4",class:"text-end"},"總計",-1),N={class:"text-end"};function U(s,a,l,r,o,u){return c(),h(p,null,[t("div",C,[t("button",{class:"btn btn-outline-danger",type:"button",disabled:o.loadingStatus.loading,onClick:a[0]||(a[0]=e=>u.removeCartAll())},"清空購物車",8,I)]),t("table",P,[y,t("tbody",null,[o.carts.carts?(c(!0),h(p,{key:0},_(o.carts.carts,e=>(c(),h("tr",{key:e.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>u.removeCartProduct(e.id,e.product.title),disabled:e.id===o.loadingStatus.loadingItem},[o.loadingStatus.loading&&o.loadingStatus.loadingItem===e.id?(c(),h("i",V)):m("",!0),f(" x ")],8,x)]),t("td",null,g(e.product.title),1),t("td",null,[t("div",k,[t("div",A,[$(t("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":i=>e.qty=i,onChange:i=>u.changeQty(e.product_id,e.id,e.qty),disabled:e.id===o.loadingStatus.loadingItem},[(c(),h(p,null,_(20,i=>t("option",{value:i,key:i+"101010"},g(i),9,T)),64))],40,E),[[b,e.qty]])])])]),t("td",w,g(e.product.price),1),t("td",D,g(e.final_total),1)]))),128)):m("",!0)]),t("tfoot",null,[t("tr",null,[L,t("td",N,g(o.carts.total),1)])])])],64)}const R=S(v,[["render",U]]);export{R as default};
